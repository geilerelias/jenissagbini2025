import{_ as U}from"./AdminLayout-0bKsuqSC.js";import{_ as $}from"./Breadcrumbs-DZKACuQP.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{l as n,c as p,o as m,w as s,b as t,a as h,i as a,f as x,F as z,j as L,t as b,z as Y,A as G}from"./app-BOimrL6G.js";import"./Logo-C4qPAGx8.js";import"./SettingsDropdown-sI980SZw.js";import"./aos-Be9VoEg5.js";const H={components:{AppLayout:U,BreadCrumbs:$},props:["data","errors"],data(){return{loadingNewItem:!1,loadingEditItem:!1,loadingDeleteItem:!1,selectedRole:[],selectedPermission:[],permission:[],editMode:!1,isOpen:!1,search:"",searchPermission:"",form:{id:null,name:null},items:[{text:"Dashboard",disabled:!1,href:"/dashboard"},{text:"Roles",disabled:!0,href:"/roles"}],dialog:!1,dialogDelete:!1,headers:[{text:"Id",align:"start",sortable:!1,value:"id"},{text:"Name",value:"name"},{text:"Actions",value:"actions",sortable:!1}],loading:!1,headersPermission:[{text:"Id",align:"start",sortable:!1,value:"id"},{text:"Name",value:"name"}],desserts:[],editedIndex:-1,editedItem:{name:""},defaultItem:{name:""}}},created(){for(let i=0;i<this.data.length;i++)axios.get(`/role/${this.data[i].id}/permissions`).then(e=>{this.data[i].permission=e.data}).catch(e=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")});axios.get("permission/all").then(i=>{this.permission=i.data}).catch(i=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")})},computed:{formTitle(){return this.editedIndex===-1?"New Item":"Edit Item"}},watch:{selectedRole(i){if(i.length>0){this.selectedPermission=[];let e=i[0].permission;for(const l in e){let I=this.permission.find(o=>o.name===e[l].name);this.selectedPermission.push(I)}}},dialog(i){i||this.close()}},methods:{grantPermissions(){if(this.selectedRole.length>0)if(this.selectedPermission.length>0){let i=[];for(let l=0;l<this.selectedPermission.length;l++)i.push(this.selectedPermission[l].name);let e={role:this.selectedRole[0].id,permission:i};this.$inertia.post("/role/assign/permissions",e,{onStart:l=>{console.log("onStart",l),this.loading=!0},onSuccess:l=>{this.$swal({icon:`${l.props.errors.name?"error":"success"}`,title:`${l.props.errors.name?"Oops...":"Good job!"}`,text:`${l.props.errors.name?l.props.errors.name[0]:l.props.flash.message}`})},onError:l=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:l=>{this.loading=!1}})}else this.$swal("Opps...!","you must select a permission.","warning");else this.$swal("Opps...!","you must select a role.","warning")},closeModal:function(){this.isOpen=!1,this.reset(),this.editMode=!1},reset(){this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},update(i){i._method="PUT",this.$inertia.post("/role/"+i.id,i,{onStart:e=>{this.loadingEditItem=!0},onSuccess:e=>{this.$swal({icon:`${e.props.errors.name?"error":"success"}`,title:`${e.props.errors.name?"Oops...":"Good job!"}`,text:`${e.props.errors.name?e.props.errors.name[0]:e.props.flash.message}`})},onError:e=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:e=>{this.loadingEditItem=!1}}),this.reset(),this.closeModal(),this.editMode=!1,this.close()},editItem(i){this.editedIndex=this.data.indexOf(i),console.log(this.editedIndex),this.editedItem=Object.assign({},i),this.dialog=!0},deleteItem(i){i._method="DELETE",this.$swal({title:"Are you sure you want to delete this item?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{e.isConfirmed&&(this.$inertia.post("/role/"+i.id,i,{onStart:l=>{this.loadingDeleteItem=!0},onSuccess:l=>{this.$swal("Deleted!","Your item has been deleted.","success")},onError:l=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:l=>{this.loadingDeleteItem=!1}}),this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))}),this.reset()},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(i){this.editedIndex===-1?(console.log("save"),this.$inertia.post("/role",i,{onStart:e=>{this.loadingNewItem=!0},onSuccess:e=>{this.$swal({icon:`${e.props.errors.name?"error":"success"}`,title:`${e.props.errors.name?"Oops...":"¡Buen trabajo!"}`,text:`${e.props.errors.name?e.props.errors.name[0]:e.props.flash.message}`})},onError:e=>{console.log(e),this.$swal({icon:"error",title:"Oops...",text:this.errors.errors.name[0]})},onFinish:e=>{this.loadingNewItem=!1,this.reset(),this.closeModal(),this.editMode=!1,this.close()}})):(console.log("update"),this.$inertia.put("/posts/"+i.id,i,{onSuccess:e=>{console.log(e),this.$swal({icon:`${e.props.errors.name?"error":"success"}`,title:`${e.props.errors.name?"Oops...":"¡Buen trabajo!"}`,text:`${e.props.errors.name?e.props.errors.name[0]:e.props.flash.message}`})},onError:e=>{console.log(e),this.$swal({icon:"error",title:"Oops...",text:this.errors.errors.name[0]})},onFinish:e=>{this.reset(),this.closeModal(),this.editMode=!1,this.close()}}))},initialize(){location.reload()}}},K={class:"text-h5"},q=["colspan"],J={key:0},Q={key:1};function W(i,e,l,I,o,d){const E=n("bread-crumbs"),f=n("v-text-field"),O=n("v-divider"),_=n("v-spacer"),c=n("v-btn"),P=n("v-card-title"),S=n("v-col"),N=n("v-row"),g=n("v-container"),w=n("v-card-text"),R=n("v-card-actions"),k=n("v-card"),B=n("v-dialog"),v=n("v-toolbar"),y=n("v-icon"),j=n("v-chip"),V=n("v-data-table"),D=n("v-toolbar-title"),M=n("v-banner"),T=n("v-sheet"),F=n("app-layout");return m(),p(F,null,{default:s(()=>[t(E,{name:"Roles",items:o.items},null,8,["items"]),t(g,{class:"d-flex justify-center"},{default:s(()=>[h("div",null,[t(V,{modelValue:o.selectedRole,"onUpdate:modelValue":e[5]||(e[5]=r=>o.selectedRole=r),headers:o.headers,items:l.data,"sort-by":"calories",search:o.search,class:"elevation-1","single-select":"","single-expand":"","show-select":"","show-expand":""},{top:s(()=>[t(v,{flat:""},{default:s(()=>[t(f,{class:"mr-3",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=r=>o.search=r),"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},null,8,["modelValue"]),t(O,{class:"mx-4",inset:"",vertical:""}),t(_),t(B,{modelValue:o.dialog,"onUpdate:modelValue":e[4]||(e[4]=r=>o.dialog=r),"max-width":"500px"},{activator:s(({on:r,attrs:u})=>[t(c,Y({color:"primary",dark:"",class:"mb-2"},u,G(r),{loading:o.loadingNewItem,disabled:o.loadingNewItem}),{default:s(()=>e[8]||(e[8]=[a(" New Item ")])),_:2},1040,["loading","disabled"])]),default:s(()=>[t(k,null,{default:s(()=>[t(P,null,{default:s(()=>[h("span",K,b(d.formTitle),1)]),_:1}),t(w,null,{default:s(()=>[t(g,null,{default:s(()=>[t(N,null,{default:s(()=>[t(S,{cols:"12"},{default:s(()=>[t(f,{modelValue:o.editedItem.name,"onUpdate:modelValue":e[1]||(e[1]=r=>o.editedItem.name=r),label:"Name"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(R,null,{default:s(()=>[t(_),t(c,{color:"blue darken-1",text:"",onClick:d.close},{default:s(()=>e[9]||(e[9]=[a(" Cancel ")])),_:1},8,["onClick"]),o.editedIndex===-1?(m(),p(c,{key:0,color:"blue darken-1",text:"",onClick:e[2]||(e[2]=r=>d.save(o.editedItem))},{default:s(()=>e[10]||(e[10]=[a(" Save ")])),_:1})):(m(),p(c,{key:1,color:"blue darken-1",text:"",onClick:e[3]||(e[3]=r=>d.update(o.editedItem))},{default:s(()=>e[11]||(e[11]=[a(" update ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":s(({item:r})=>[t(y,{small:"",class:"mr-2",onClick:u=>d.editItem(r),loading:o.loadingEditItem,disabled:o.loadingEditItem},{default:s(()=>e[12]||(e[12]=[a(" mdi-pencil ")])),_:2},1032,["onClick","loading","disabled"]),t(y,{small:"",onClick:u=>d.deleteItem(r),loading:o.loadingDeleteItem,disabled:o.loadingDeleteItem},{default:s(()=>e[13]||(e[13]=[a(" mdi-delete ")])),_:2},1032,["onClick","loading","disabled"])]),"expanded-item":s(({headers:r,item:u})=>[h("td",{colspan:r.length},[e[14]||(e[14]=a(" established permissions: ")),(m(!0),x(z,null,L(u.permission,C=>(m(),p(j,{key:C.id,class:"ma-2 white--text",color:"indigo",small:""},{default:s(()=>[a(b(C.name),1)]),_:2},1024))),128))],8,q)]),"no-data":s(()=>[t(c,{color:"primary",onClick:d.initialize},{default:s(()=>e[15]||(e[15]=[a(" Reset ")])),_:1},8,["onClick"])]),_:1},8,["modelValue","headers","items","search"])])]),_:1}),t(g,null,{default:s(()=>[t(k,null,{default:s(()=>[t(v,{flat:""},{default:s(()=>[t(D,null,{default:s(()=>e[16]||(e[16]=[a("Permission")])),_:1}),t(_),o.selectedRole.length>0?(m(),x("span",J,"selected role "+b(o.selectedRole[0].name),1)):(m(),x("span",Q," role not selected"))]),_:1}),t(M,{"single-line":""},{actions:s(()=>[t(c,{text:"",color:"deep-purple accent-4",onClick:d.grantPermissions,loading:o.loading,disabled:o.loading},{default:s(()=>e[17]||(e[17]=[a(" grant permissions ")])),_:1},8,["onClick","loading","disabled"])]),default:s(()=>[e[18]||(e[18]=a(" choose the permissions for the selected role. "))]),_:1}),t(w,{class:"grey lighten-4"},{default:s(()=>[t(T,{"max-width":"500",class:"mx-auto"},{default:s(()=>[h("div",null,[t(V,{modelValue:o.selectedPermission,"onUpdate:modelValue":e[7]||(e[7]=r=>o.selectedPermission=r),headers:o.headersPermission,items:o.permission,"sort-by":"calories",search:o.searchPermission,class:"elevation-1","show-select":""},{top:s(()=>[t(v,{flat:""},{default:s(()=>[t(f,{class:"mx-auto",modelValue:o.searchPermission,"onUpdate:modelValue":e[6]||(e[6]=r=>o.searchPermission=r),"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","headers","items","search"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const le=A(H,[["render",W]]);export{le as default};
