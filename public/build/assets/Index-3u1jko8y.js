import{_ as A}from"./AdminLayout-0bKsuqSC.js";import{_ as D}from"./Breadcrumbs-DZKACuQP.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{l as r,c as p,o as i,w as t,b as l,a as u,i as n,f,F as T,j as z,t as k}from"./app-BOimrL6G.js";import"./Logo-C4qPAGx8.js";import"./SettingsDropdown-sI980SZw.js";import"./aos-Be9VoEg5.js";const L={name:"User",components:{AppLayout:A,BreadCrumbs:D},props:["data","errors"],data:()=>({loading:!1,headers:[{text:"Photo",value:"profile_photo_url"},{text:"Name",value:"name"},{text:"Email",value:"email"}],headersRole:[{text:"Id",align:"start",sortable:!1,value:"id"},{text:"Name",value:"name"},{text:"Actions",value:"actions",sortable:!1}],selectedRole:[],search:"",items:[{text:"Dashboard",disabled:!1,href:"/dashboard"},{text:"Users",disabled:!0,href:"/user"}],selectedUser:[],role:[],searchRole:"",users:[]}),created(){axios.get("role/all").then(e=>{this.role=e.data}).catch(e=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")}),this.users=this.data;for(const e in this.users){let s=this.users[e];axios.get(`/user/${s.id}/roles`).then(o=>{this.users[e].roles=o.data}).catch(o=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")})}},watch:{selectedUser(e){if(e.length>0){this.selectedRole=[];let s=e[0].roles;for(const o in s){let c=this.role.find(_=>_.name===s[o]);this.selectedRole.push(c)}}}},methods:{removeRole(e){console.log(e),this.$swal({title:"Are you sure you want to delete this item?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(s=>{if(s.isConfirmed){let o={role:e,user:this.selectedUser[0].id};this.$inertia.post("user/remove/roles",o,{onSuccess:c=>{console.log(c),this.$swal("Deleted!",this.$page.flash.message,"success")},onError:c=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")}}),this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})}})},isSelected(e){var s=this.selectedRole.indexOf(e);return s!=-1},grantRoles(){if(this.selectedUser.length>0)if(console.log("selectedRole",this.selectedRole.length),this.selectedRole.length>0){let e=[];for(let o=0;o<this.selectedRole.length;o++)e.push(this.selectedRole[o].name);let s={user:this.selectedUser[0].id,role:e};this.$inertia.post("/user/assign/roles",s,{onStart:o=>{console.log("onStart",o),this.loading=!0},onSuccess:o=>{this.$swal({icon:`${o.props.errors.name?"error":"success"}`,title:`${o.props.errors.name?"Oops...":"Good job!"}`,text:`${o.props.errors.name?o.props.errors.name[0]:o.props.flash.message}`})},onError:o=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:o=>{this.loading=!1}})}else this.$swal("Opps...!","you must select a rol.","warning");else this.$swal("Opps...!","you must select a user.","warning")},initialize(){location.reload()}}},Y={class:"d-flex align-center py-4"},G=["colspan"],K={key:0},P={key:1},q={class:"d-flex align-center py-4"};function H(e,s,o,c,_,m){const $=r("bread-crumbs"),v=r("v-text-field"),U=r("v-divider"),g=r("v-spacer"),d=r("v-btn"),V=r("inertia-link"),h=r("v-toolbar"),C=r("v-img"),B=r("v-chip"),b=r("v-data-table"),x=r("v-container"),O=r("v-toolbar-title"),S=r("v-banner"),w=r("v-icon"),E=r("v-sheet"),I=r("v-card-text"),N=r("v-card"),j=r("app-layout");return i(),p(j,null,{default:t(()=>[l($,{name:"Users",items:e.items},null,8,["items"]),l(x,{class:"d-flex justify-center"},{default:t(()=>[u("div",null,[l(b,{modelValue:e.selectedUser,"onUpdate:modelValue":s[1]||(s[1]=a=>e.selectedUser=a),headers:e.headers,items:o.data,"sort-by":"name",search:e.search,class:"elevation-1","single-select":"","single-expand":"","show-select":"","show-expand":""},{top:t(()=>[l(h,{flat:""},{default:t(()=>[l(v,{class:"mr-3",modelValue:e.search,"onUpdate:modelValue":s[0]||(s[0]=a=>e.search=a),"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},null,8,["modelValue"]),l(U,{class:"mx-4",inset:"",vertical:""}),l(g),l(V,{href:e.route("user.create")},{default:t(()=>[l(d,{color:"primary",dark:"",class:"mb-2"},{default:t(()=>s[4]||(s[4]=[n(" New Item ")])),_:1})]),_:1},8,["href"])]),_:1})]),"item.profile_photo_url":t(({item:a})=>[u("div",Y,[l(d,{fab:"",dark:"",text:"",small:""},{default:t(()=>[l(C,{style:{"max-height":"35px","max-width":"35px"},class:"rounded-circle",cover:"",src:a.profile_photo_url,alt:a.name},null,8,["src","alt"])]),_:2},1024)])]),"expanded-item":t(({headers:a,item:y})=>[u("td",{colspan:a.length},[s[5]||(s[5]=n(" established roles: ")),(i(!0),f(T,null,z(y.roles,R=>(i(),p(B,{key:R.id,class:"ma-2 white--text",color:"indigo",small:""},{default:t(()=>[n(k(R),1)]),_:2},1024))),128))],8,G)]),"no-data":t(()=>[l(d,{color:"primary",onClick:m.initialize},{default:t(()=>s[6]||(s[6]=[n(" Reset ")])),_:1},8,["onClick"])]),_:1},8,["modelValue","headers","items","search"])])]),_:1}),l(x,null,{default:t(()=>[l(N,null,{default:t(()=>[l(h,{flat:""},{default:t(()=>[l(O,null,{default:t(()=>s[7]||(s[7]=[n("Roles")])),_:1}),l(g),e.selectedUser.length>0?(i(),f("span",K,"selected User "+k(e.selectedUser[0].name),1)):(i(),f("span",P," User not selected"))]),_:1}),l(S,{"single-line":""},{actions:t(()=>[l(d,{text:"",color:"deep-purple accent-4",onClick:m.grantRoles,loading:e.loading,disabled:e.loading},{default:t(()=>s[8]||(s[8]=[n(" grant Roles ")])),_:1},8,["onClick","loading","disabled"])]),default:t(()=>[s[9]||(s[9]=n(" choose the Roles for the selected role. "))]),_:1}),l(I,{class:"grey lighten-4"},{default:t(()=>[l(E,{"max-width":"500",class:"mx-auto"},{default:t(()=>[u("div",null,[l(b,{modelValue:e.selectedRole,"onUpdate:modelValue":s[3]||(s[3]=a=>e.selectedRole=a),headers:e.headersRole,items:e.role,"sort-by":"calories",search:e.searchRole,class:"elevation-1","show-select":""},{top:t(()=>[l(h,{flat:""},{default:t(()=>[l(v,{class:"mx-auto",modelValue:e.searchRole,"onUpdate:modelValue":s[2]||(s[2]=a=>e.searchRole=a),"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},null,8,["modelValue"])]),_:1})]),"item.actions":t(({item:a})=>[u("div",q,[m.isSelected(a)?(i(),p(d,{key:0,icon:"",class:"primary--text",onClick:y=>m.removeRole(a)},{default:t(()=>[l(w,null,{default:t(()=>s[10]||(s[10]=[n(" mdi-close-circle ")])),_:1})]),_:2},1032,["onClick"])):(i(),p(d,{key:1,icon:"",disabled:"",class:"primary--text"},{default:t(()=>[l(w,null,{default:t(()=>s[11]||(s[11]=[n(" mdi-close-circle ")])),_:1})]),_:1}))])]),_:1},8,["modelValue","headers","items","search"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const se=F(L,[["render",H]]);export{se as default};
